<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.elbigs.mybatisMapper.DisplayMapper">
    <select id="selectMediaLibList1" resultType="com.elbigs.entity.MediaLibEntity">
        select *
          from media_lib ml
         where ml.media_type in ( 'I', 'V' )
       <if test="mediaCategoryId > 0">
           and ml.media_category_id = #{mediaCategoryId}
        </if>
         order by updated_at desc, created_at desc
    </select>
    <select id="selectTemplateCategoryList" resultType="com.elbigs.entity.TemplateCategoryEntity">
        with recursive cte as (
        select ARRAY[sort_no] AS hierarchy
             , template_category_id
             , name
             , upper_category_id
             , sort_no
             , 1 as level
          from template_category
         where upper_category_id is null
         union all
        select c.hierarchy || c.sort_no
             , e.template_category_id
             , e.name
             , e.upper_category_id
             , e.sort_no
             , c.level + 1
          from cte c
          join template_category e on e.upper_category_id = c.template_category_id
        )
        select *
          from cte
         order by hierarchy
    </select>
    <select id="selectMediaLibList" resultType="com.elbigs.dto.MediaLibDto">
        select ml.*, mc.media_category_name
          from media_lib ml
          left outer join media_category mc on ml.media_category_id = mc.media_category_id
         where 1 = 1
        <if test="mediaCategoryId!=null">
           and ml.media_category_id = #{mediaCategoryId}
        </if>
   <choose>
        <when test="mediaType!=null and mediaType=='IV'">
           and ml.media_type in ( 'I', 'V' )
        </when>
        <when test="mediaType!=null and mediaType!=''">
           and ml.media_type = #{mediaType}
        </when>
   </choose>
        order by ml.updated_at desc
               , ml.created_at desc
    </select>
</mapper>
